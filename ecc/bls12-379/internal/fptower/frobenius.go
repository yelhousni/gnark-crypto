// Copyright 2020 ConsenSys AG
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

package fptower

import (
	"github.com/consensys/gnark-crypto/ecc/bls12-379/fp"
)

// Frobenius set z to Frobenius(x), return z
func (z *E12) Frobenius(x *E12) *E12 {
	// Algorithm 28 from https://eprint.iacr.org/2010/354.pdf (beware typos!)
	var t [6]E2

	// Frobenius acts on fp2 by conjugation
	t[0].Conjugate(&x.C0.B0)
	t[1].Conjugate(&x.C0.B1)
	t[2].Conjugate(&x.C0.B2)
	t[3].Conjugate(&x.C1.B0)
	t[4].Conjugate(&x.C1.B1)
	t[5].Conjugate(&x.C1.B2)

	t[1].MulByNonResidue1Power2(&t[1])
	t[2].MulByNonResidue1Power4(&t[2])
	t[3].MulByNonResidue1Power1(&t[3])
	t[4].MulByNonResidue1Power3(&t[4])
	t[5].MulByNonResidue1Power5(&t[5])

	z.C0.B0 = t[0]
	z.C0.B1 = t[1]
	z.C0.B2 = t[2]
	z.C1.B0 = t[3]
	z.C1.B1 = t[4]
	z.C1.B2 = t[5]

	return z
}

// FrobeniusSquare set z to Frobenius^2(x), and return z
func (z *E12) FrobeniusSquare(x *E12) *E12 {
	// Algorithm 29 from https://eprint.iacr.org/2010/354.pdf (beware typos!)
	var t [6]E2

	t[1].MulByNonResidue2Power2(&x.C0.B1)
	t[2].MulByNonResidue2Power4(&x.C0.B2)
	t[3].MulByNonResidue2Power1(&x.C1.B0)
	t[4].MulByNonResidue2Power3(&x.C1.B1)
	t[5].MulByNonResidue2Power5(&x.C1.B2)

	z.C0.B0 = x.C0.B0
	z.C0.B1 = t[1]
	z.C0.B2 = t[2]
	z.C1.B0 = t[3]
	z.C1.B1 = t[4]
	z.C1.B2 = t[5]

	return z
}

// FrobeniusCube set z to Frobenius^3(x), return z
func (z *E12) FrobeniusCube(x *E12) *E12 {
	// Algorithm 30 from https://eprint.iacr.org/2010/354.pdf (beware typos!)
	var t [6]E2

	// Frobenius^3 acts on fp2 by conjugation
	t[0].Conjugate(&x.C0.B0)
	t[1].Conjugate(&x.C0.B1)
	t[2].Conjugate(&x.C0.B2)
	t[3].Conjugate(&x.C1.B0)
	t[4].Conjugate(&x.C1.B1)
	t[5].Conjugate(&x.C1.B2)

	t[1].MulByNonResidue3Power2(&t[1])
	t[2].MulByNonResidue3Power4(&t[2])
	t[3].MulByNonResidue3Power1(&t[3])
	t[4].MulByNonResidue3Power3(&t[4])
	t[5].MulByNonResidue3Power5(&t[5])

	z.C0.B0 = t[0]
	z.C0.B1 = t[1]
	z.C0.B2 = t[2]
	z.C1.B0 = t[3]
	z.C1.B1 = t[4]
	z.C1.B2 = t[5]

	return z
}

// MulByNonResidue1Power1 set z=x*(5,1)^(1*(p^1-1)/6) and return z
func (z *E2) MulByNonResidue1Power1(x *E2) *E2 {
	// 414518866893299520774533851287519605842142587698028831200134560538678326980844860014360998051058161514159094933407*u + 203655906493816528830011000986269184067177591622487709991600346471627762536386317513560581605764541426329190222863
	b := E2{
		A0: fp.Element{
			142627012441529357,
			8773113443032315391,
			10215213646805759107,
			5082419331403129268,
			2614274796278799378,
			231916782915236920,
		},
		A1: fp.Element{
			16718656523308998678,
			12280612659558149725,
			10006743080847961944,
			12452447385514075397,
			12600314031769843467,
			184530493813034901,
		},
	}
	z.Mul(x, &b)
	return z
}

// MulByNonResidue1Power2 set z=x*(5,1)^(2*(p^1-1)/6) and return z
func (z *E2) MulByNonResidue1Power2(x *E2) *E2 {
	// 53608708391251269430337404591046336897908586198581852257006640780158581836659927408814995415886520684560049511630*u + 222745979508143237255341693926393623218761351828393355617642805276543242213727214918790809594387987052224624366927
	b := E2{
		A0: fp.Element{
			191659197544648438,
			3751428082226668919,
			13484036186397191581,
			11618073660119020121,
			12300593291738943339,
			176549824770558291,
		},
		A1: fp.Element{
			1894411593424440993,
			3673988060868738449,
			12501047480675750805,
			5935552843802372912,
			1207422432990976279,
			187698050467287902,
		},
	}
	z.Mul(x, &b)

	return z
}

// MulByNonResidue1Power3 set z=x*(5,1)^(3*(p^1-1)/6) and return z
func (z *E2) MulByNonResidue1Power3(x *E2) *E2 {
	// 205343422135153100463306508509910492825903335462897260204806706089537866940279563177678964270966750592224060664130*u + 205343422135153100463306508509910492825903335462897260204806706089537866940279563177678964270966750592224060664130
	b := E2{
		A0: fp.Element{
			18262126071034944718,
			10006108714112390855,
			16261712704919248943,
			18016616882062288561,
			9182391268187218428,
			32645933029088738,
		},
		A1: fp.Element{
			18262126071034944718,
			10006108714112390855,
			16261712704919248943,
			18016616882062288561,
			9182391268187218428,
			32645933029088738,
		},
	}
	z.Mul(x, &b)
	return z
}

// MulByNonResidue1Power4 set z=x*(5,1)^(4*(p^1-1)/6) and return z
func (z *E2) MulByNonResidue1Power4(x *E2) *E2 {
	// 566517341602089752622755670222547387356998150969324007705962071587820115998194123780876625271462057677260485699100*u + 287899191390642801836439670966953814749256108484332781706798064987356096685699281368588190616115413206704411748826
	b := E2{
		A0: fp.Element{
			9571032015633235893,
			3542178947529611488,
			12172632524840599128,
			7566232574142901407,
			10896063299607651396,
			18049896114999089,
		},
		A1: fp.Element{
			3864328188548015105,
			16050454835173649243,
			5576964239095962056,
			18255965997127480307,
			8279968091246840634,
			244781066157352501,
		},
	}
	z.Mul(x, &b)
	return z
}

// MulByNonResidue1Power5 set z=x*(5,1)^(5*(p^1-1)/6) and return z
func (z *E2) MulByNonResidue1Power5(x *E2) *E2 {
	// 552650312470423687387352870093973863440404004451798955009228238197019448012900941006486681864199947216354482375786*u + 548073517291981638195581764660200345783051473601924390719911312990078155864517573330740120016667141526902331592956
	b := E2{
		A0: fp.Element{
			5913101601893520212,
			69850320063674790,
			1768479734828087843,
			7221042577763124564,
			13782175774724811488,
			243475600599898695,
		},
		A1: fp.Element{
			14519747306043491820,
			2547487977196569333,
			392872004778503781,
			11129696514803920995,
			441855416257052821,
			117586731730334132,
		},
	}
	z.Mul(x, &b)
	return z
}

// MulByNonResidue2Power1 set z=x*(5,1)^(1*(p^2-1)/6) and return z
func (z *E2) MulByNonResidue2Power1(x *E2) *E2 {
	// 173890623291670311836512360316100953774879339360001038672113943180607164901767459447515297873922
	b := fp.Element{
		2741829847194294953,
		10785640562261281485,
		13443661666862533171,
		3803436800460899386,
		6702159743253276016,
		103001932634692954,
	}
	z.A0.Mul(&x.A0, &b)
	z.A1.Mul(&x.A1, &b)
	return z
}

// MulByNonResidue2Power2 set z=x*(5,1)^(2*(p^2-1)/6) and return z
func (z *E2) MulByNonResidue2Power2(x *E2) *E2 {
	// 173890623291670311836512360316100953774879339360001038672113943180607164901767459447515297873921
	b := fp.Element{
		1585530642866920166,
		742283471017265906,
		13980708892630354491,
		14982029520902389571,
		6284538067360200461,
		146447473254547261,
	}
	z.A0.Mul(&x.A0, &b)
	z.A1.Mul(&x.A1, &b)
	return z
}

// MulByNonResidue2Power3 set z=x*(5,1)^(3*(p^2-1)/6) and return z
func (z *E2) MulByNonResidue2Power3(x *E2) *E2 {
	// 647455824720115791999401948377863964948475498868568187799869012112522291430466516542182303552703940519176779595776
	b := fp.Element{
		17290444869382176829,
		8403386982465536036,
		537047225767821319,
		11178592720441490185,
		18029122397816476061,
		43445540619854306,
	}
	z.A0.Mul(&x.A0, &b)
	z.A1.Mul(&x.A1, &b)
	return z
}

// MulByNonResidue2Power4 set z=x*(5,1)^(4*(p^2-1)/6) and return z
func (z *E2) MulByNonResidue2Power4(x *E2) *E2 {
	// 647455824720115791825511325086193653111963138552467234024989672752521252758352573361575138650936481071661481721855
	b := fp.Element{
		8428223128591377752,
		9915703437652079923,
		7733537224701998540,
		13012129048300851909,
		12342549354579653102,
		200115929895297306,
	}
	z.A0.Mul(&x.A0, &b)
	z.A1.Mul(&x.A1, &b)
	return z
}

// MulByNonResidue2Power5 set z=x*(5,1)^(5*(p^2-1)/6) and return z
func (z *E2) MulByNonResidue2Power5(x *E2) *E2 {
	// 647455824720115791825511325086193653111963138552467234024989672752521252758352573361575138650936481071661481721856
	b := fp.Element{
		9584522332918752539,
		1512316455186543886,
		7196489998934177221,
		1833536327859361724,
		12760171030472728657,
		156670389275442999,
	}
	z.A0.Mul(&x.A0, &b)
	z.A1.Mul(&x.A1, &b)
	return z
}

// MulByNonResidue3Power1 set z=x*(5,1)^(1*(p^3-1)/6) and return z
func (z *E2) MulByNonResidue3Power1(x *E2) *E2 {
	// 318187756250793399765227737859038331781620249664634743646388144887528386180484828586749855746709899648186080785806*u + 111901591029752457012475992991561427664007784438968186727170856027419113884409653761696001148949085249808326858092
	b := E2{
		A0: fp.Element{
			8102308738778634505,
			674530475844446676,
			3542099140314689642,
			12668970446331064012,
			311497998127196960,
			265577602065861343,
		},
		A1: fp.Element{
			4901639569710459513,
			17896536182743128291,
			1978781486551496444,
			17761522788349014030,
			4593148494253070597,
			40962319303233627,
		},
	}
	z.Mul(x, &b)
	return z
}

// MulByNonResidue3Power2 set z=x*(5,1)^(2*(p^3-1)/6) and return z
func (z *E2) MulByNonResidue3Power2(x *E2) *E2 {
	// 204217308233650902263845616420348537940350384319555684182611091236666097247213743387238050452892008662789485005453*u + 313698187328205885225157326340594824227239661174735406821138933340745456182641298289550670929737186765680984100430
	b := E2{
		A0: fp.Element{
			12166029155419587219,
			2191133271000120544,
			18440389318384931788,
			1466551903191811707,
			384226018503873993,
			219385354748363151,
		},
		A1: fp.Element{
			8893289488701136541,
			10461641404627374668,
			10302757053996438115,
			13274905145285631313,
			14691457109736029317,
			284623821539270389,
		},
	}
	z.Mul(x, &b)
	return z
}

// MulByNonResidue3Power3 set z=x*(5,1)^(3*(p^3-1)/6) and return z
func (z *E2) MulByNonResidue3Power3(x *E2) *E2 {
	// 442112402584962691536095439867953472122572163405670927595062306022984424490186953364503339281737189926952718931647*u + 442112402584962691536095439867953472122572163405670927595062306022984424490186953364503339281737189926952718931647
	b := E2{
		A0: fp.Element{
			11354670978460279603,
			10695235285800970552,
			4915486186645282768,
			17245693040409014350,
			9862317829645710689,
			270471929500901522,
		},
		A1: fp.Element{
			11354670978460279603,
			10695235285800970552,
			4915486186645282768,
			17245693040409014350,
			9862317829645710689,
			270471929500901522,
		},
	}
	z.Mul(x, &b)
	return z
}

// MulByNonResidue3Power4 set z=x*(5,1)^(4*(p^3-1)/6) and return z
func (z *E2) MulByNonResidue3Power4(x *E2) *E2 {
	// 622563498361651826081586411443387986561987188553475325337704977545337171681599093701567480791764852661815721423924*u + 84588552736091017043496172985770307900400966540086860176363807536894239186560132061697797715906090245530440923124
	b := E2{
		A0: fp.Element{
			3330813524876141577,
			6980630432404960450,
			583240757972517858,
			6335076366272141003,
			1561977642635357626,
			278119592326771973,
		},
		A1: fp.Element{
			7334764956081569810,
			12996538639828404781,
			8161897749438595705,
			1327863759604209312,
			15271243709744135448,
			40240196587688950,
		},
	}
	z.Mul(x, &b)
	return z
}

// MulByNonResidue3Power5 set z=x*(5,1)^(5*(p^3-1)/6) and return z
func (z *E2) MulByNonResidue3Power5(x *E2) *E2 {
	// 33607092937074488181176506777258042092924261633223162073359377896651198271637598131004469696554981342334569611309*u + 239893258158115430933928251644734946210536726858889718992576666756760470567712772956058324294315795740712323539023
	b := E2{
		A0: fp.Element{
			7788998408214165018,
			7036814481933323672,
			15964853917704048820,
			7227550075606812644,
			14194461873696881064,
			194336659991472077,
		},
		A1: fp.Element{
			18266358675206218921,
			6006952922540383880,
			14797716753612261921,
			3766175958536662946,
			9314846353447629924,
			115834080224109532,
		},
	}
	z.Mul(x, &b)
	return z
}
